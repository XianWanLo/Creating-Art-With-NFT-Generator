{"ast":null,"code":"import SturdyWebSocket from \"sturdy-websocket\";\nimport { w3cwebsocket } from \"websocket\";\nimport { makePayloadFactory, makeSenders } from \"../util/jsonRpc\";\nimport { VERSION } from \"../version\";\nimport { makeHttpSender } from \"./alchemySendHttp\";\nimport { makeWebSocketSender } from \"./alchemySendWebSocket\";\nimport { makeAlchemyHttpProvider } from \"./httpProvider\";\nimport { makePayloadSender } from \"./sendPayload\";\nimport { AlchemyWebSocketProvider } from \"./webSocketProvider\";\nvar NODE_MAX_WS_FRAME_SIZE = 100 * 1024 * 1024; // 100 MB\n\nexport function makeAlchemyContext(url, config) {\n  var makePayload = makePayloadFactory();\n\n  if (/^https?:\\/\\//.test(url)) {\n    var alchemySend = makeHttpSender(url);\n\n    var _a = makePayloadSender(alchemySend, config, makePayload),\n        sendPayload = _a.sendPayload,\n        setWriteProvider = _a.setWriteProvider;\n\n    var senders = makeSenders(sendPayload, makePayload);\n    var provider = makeAlchemyHttpProvider(sendPayload);\n    return {\n      provider: provider,\n      senders: senders,\n      setWriteProvider: setWriteProvider\n    };\n  } else if (/^wss?:\\/\\//.test(url)) {\n    var protocol = isAlchemyUrl(url) ? \"alchemy-web3-\" + VERSION : undefined;\n    var ws = new SturdyWebSocket(url, protocol, {\n      wsConstructor: getWebSocketConstructor()\n    });\n    var alchemySend = makeWebSocketSender(ws);\n\n    var _b = makePayloadSender(alchemySend, config, makePayload),\n        sendPayload = _b.sendPayload,\n        setWriteProvider = _b.setWriteProvider;\n\n    var senders = makeSenders(sendPayload, makePayload);\n    var provider = new AlchemyWebSocketProvider(ws, sendPayload, senders);\n    return {\n      provider: provider,\n      senders: senders,\n      setWriteProvider: setWriteProvider\n    };\n  } else {\n    throw new Error(\"Alchemy URL protocol must be one of http, https, ws, or wss. Recieved: \" + url);\n  }\n}\n\nfunction getWebSocketConstructor() {\n  return isNodeEnvironment() ? function (url, protocols) {\n    return new w3cwebsocket(url, protocols, undefined, undefined, undefined, {\n      maxReceivedMessageSize: NODE_MAX_WS_FRAME_SIZE,\n      maxReceivedFrameSize: NODE_MAX_WS_FRAME_SIZE\n    });\n  } : WebSocket;\n}\n\nfunction isNodeEnvironment() {\n  return typeof process !== \"undefined\" && process != null && process.versions != null && process.versions.node != null;\n}\n\nfunction isAlchemyUrl(url) {\n  return url.indexOf(\"alchemyapi.io\") >= 0;\n}","map":{"version":3,"sources":["../../../src/web3-adapter/alchemyContext.ts"],"names":[],"mappings":"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","sourcesContent":["import SturdyWebSocket from \"sturdy-websocket\";\nimport { w3cwebsocket } from \"websocket\";\nimport { FullConfig, Provider } from \"../types\";\nimport {\n  JsonRpcSenders,\n  makePayloadFactory,\n  makeSenders,\n} from \"../util/jsonRpc\";\nimport { VERSION } from \"../version\";\nimport { makeHttpSender } from \"./alchemySendHttp\";\nimport { makeWebSocketSender } from \"./alchemySendWebSocket\";\nimport { makeAlchemyHttpProvider } from \"./httpProvider\";\nimport { makePayloadSender } from \"./sendPayload\";\nimport { AlchemyWebSocketProvider } from \"./webSocketProvider\";\n\nconst NODE_MAX_WS_FRAME_SIZE = 100 * 1024 * 1024; // 100 MB\n\nexport interface AlchemyContext {\n  provider: any;\n  senders: JsonRpcSenders;\n  setWriteProvider(provider: Provider | null | undefined): void;\n}\n\nexport function makeAlchemyContext(\n  url: string,\n  config: FullConfig,\n): AlchemyContext {\n  const makePayload = makePayloadFactory();\n  if (/^https?:\\/\\//.test(url)) {\n    const alchemySend = makeHttpSender(url);\n    const { sendPayload, setWriteProvider } = makePayloadSender(\n      alchemySend,\n      config,\n      makePayload,\n    );\n    const senders = makeSenders(sendPayload, makePayload);\n    const provider = makeAlchemyHttpProvider(sendPayload);\n    return { provider, senders, setWriteProvider };\n  } else if (/^wss?:\\/\\//.test(url)) {\n    const protocol = isAlchemyUrl(url) ? `alchemy-web3-${VERSION}` : undefined;\n    const ws = new SturdyWebSocket(url, protocol, {\n      wsConstructor: getWebSocketConstructor(),\n    });\n    const alchemySend = makeWebSocketSender(ws);\n    const { sendPayload, setWriteProvider } = makePayloadSender(\n      alchemySend,\n      config,\n      makePayload,\n    );\n    const senders = makeSenders(sendPayload, makePayload);\n    const provider = new AlchemyWebSocketProvider(ws, sendPayload, senders);\n    return { provider, senders, setWriteProvider };\n  } else {\n    throw new Error(\n      `Alchemy URL protocol must be one of http, https, ws, or wss. Recieved: ${url}`,\n    );\n  }\n}\n\nfunction getWebSocketConstructor(): any {\n  return isNodeEnvironment()\n    ? (url: string, protocols?: string | string[] | undefined) =>\n        new w3cwebsocket(url, protocols, undefined, undefined, undefined, {\n          maxReceivedMessageSize: NODE_MAX_WS_FRAME_SIZE,\n          maxReceivedFrameSize: NODE_MAX_WS_FRAME_SIZE,\n        })\n    : WebSocket;\n}\n\nfunction isNodeEnvironment(): boolean {\n  return (\n    typeof process !== \"undefined\" &&\n    process != null &&\n    process.versions != null &&\n    process.versions.node != null\n  );\n}\n\nfunction isAlchemyUrl(url: string): boolean {\n  return url.indexOf(\"alchemyapi.io\") >= 0;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}